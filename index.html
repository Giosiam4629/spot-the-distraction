<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spot the Distraction - Adventure Edition</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Comic+Neue:wght@400;700&display=swap">
  <style>
    :root {
      --bg-color: #eaf5ff;
      --panel-bg: #ffffff;
      --primary-text: #3d5a80;
      --accent-green: #2a9d8f;
      --accent-red: #e76f51;
      --accent-orange: #f4a261;
      --font-header: 'Fredoka One', cursive;
      --font-body: 'Comic Neue', sans-serif;
      --shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    }

    /* --- General Setup --- */
    body {
      font-family: var(--font-body);
      background-color: var(--bg-color);
      color: var(--primary-text);
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .main-container {
      width: 100%;
      max-width: 900px;
    }
    .panel {
      background-color: var(--panel-bg);
      border-radius: 20px;
      padding: 20px 30px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
    }
    h2, h3 {
      font-family: var(--font-header);
      color: var(--primary-text);
      margin-top: 0;
    }

    /* --- Screens --- */
    .screen { display: none; }
    .screen.active { display: block; }
    
    /* --- Game Controls Panel --- */
    #game-controls h2 {
      font-size: 1.2rem;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .control-section {
      margin-bottom: 20px;
      border-top: 1px solid #eee;
      padding-top: 15px;
    }
    .options-group {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
    }
    .options-group input[type="radio"] { display: none; }
    .options-group label {
      padding: 8px 15px;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      font-weight: bold;
      background-color: #f0f0f0;
    }
    .options-group input[type="radio"]:checked + label {
      background-color: var(--accent-orange);
      color: white;
      transform: scale(1.1);
    }
    #game-progress-bar {
      width: 100%;
      height: 20px;
      background-color: #e0e0e0;
      border-radius: 10px;
      overflow: hidden;
    }
    #game-progress-fill {
      width: 0%;
      height: 100%;
      background-color: var(--accent-green);
      transition: width 0.5s ease;
    }
    .stats-container {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }
    .stat-box {
      background-color: #f7f9fc;
      border-radius: 10px;
      padding: 10px 20px;
      font-family: var(--font-header);
      font-size: 1.2rem;
      min-width: 100px;
      text-align: center;
    }
    
    /* --- Sorting Game --- */
    .drop-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    .dropzone {
      border: 3px dashed #ccc;
      min-height: 200px;
      padding: 15px;
      border-radius: 15px;
      transition: all 0.3s;
    }
    #closer { background-color: #e8f5e9; }
    #distraction { background-color: #ffebee; }
    .dropzone.over { transform: scale(1.02); border-color: var(--accent-orange); }
    #cards-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      min-height: 150px;
      padding: 20px 0;
    }
    .card {
      background-color: var(--panel-bg);
      border: 3px solid;
      padding: 15px;
      border-radius: 12px;
      cursor: grab;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: var(--shadow);
      transition: transform 0.2s;
    }
    .card:hover { transform: translateY(-5px); }
    .card .emoji { font-size: 2rem; }

    /* --- Minigame Screen --- */
    #minigame-screen { text-align: center; }
    .minigame-header {
      display: flex;
      justify-content: space-around;
      align-items: center;
      flex-wrap: wrap;
    }
    .minigame-stat { font-family: var(--font-header); font-size: 1.2rem; }
    .minigame-stat .hearts { font-size: 1.8rem; letter-spacing: 2px; }
    canvas#minigame-canvas {
      background: linear-gradient(#87CEEB, #90EE90);
      border-radius: 15px;
      box-shadow: var(--shadow);
      margin: 20px 0;
      width: 100%;
      image-rendering: pixelated; /* Crucial for 16-bit look */
      image-rendering: -moz-crisp-edges;
      image-rendering: crisp-edges;
    }
    #minigame-start-btn {
      padding: 15px 30px;
      font-size: 1.5rem;
      background-color: var(--accent-orange);
      color: white;
      border: none;
      border-radius: 15px;
      cursor: pointer;
    }
    #minigame-instructions { margin-top: 15px; font-style: italic; }

    /* Buttons */
    #switch-to-minigame-btn {
        margin-top: 20px;
        background-color: #6a0dad;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-family: var(--font-header);
    }
  </style>
</head>
<body>

<div class="main-container">

  <div id="sorting-game-screen" class="screen active">
    <div id="game-controls" class="panel">
      <div class="control-section">
        <h2>👤 Choose Your Character</h2>
        <div class="options-group" id="character-selector">
          <input type="radio" id="char-cello" name="character" value="cello" checked><label for="char-cello">Cello (7-yr) 👦</label>
          <input type="radio" id="char-fina" name="character" value="fina"><label for="char-fina">Fina (11-yr) 👧</label>
          <input type="radio" id="char-teen" name="character" value="teen"><label for="char-teen">Teen (15-yr) 👩‍🎓</label>
          <input type="radio" id="char-adult" name="character" value="adult"><label for="char-adult">Adult 👨‍👩‍👧‍👦</label>
        </div>
      </div>
      <div class="control-section">
        <h2>⚡ Difficulty Level</h2>
        <div class="options-group" id="difficulty-selector">
          <input type="radio" id="diff-easy" name="difficulty" value="easy" checked><label for="diff-easy">Easy (No Timer) 😊</label>
          <input type="radio" id="diff-medium" name="difficulty" value="medium"><label for="diff-medium">Medium (2 min timer) ⏰</label>
          <input type="radio" id="diff-hard" name="difficulty" value="hard"><label for="diff-hard">Hard (1 min timer) 🔥</label>
        </div>
      </div>
      <div class="control-section">
        <h2>📊 Game Progress</h2>
        <p>Level: <span id="level-label">1</span> / 5</p>
        <div id="game-progress-bar"><div id="game-progress-fill"></div></div>
      </div>
      <div class="stats-container">
        <div class="stat-box">Score: <span id="score-label">0</span></div>
        <div class="stat-box">Streak: <span id="streak-label">0</span></div>
        <div class="stat-box">Time: <span id="timer-label">--:--</span></div>
      </div>
    </div>
    
    <div class="panel">
      <div class="drop-container">
        <div id="closer" class="dropzone"><h3>👍 Keeps Me Close to Jehovah</h3></div>
        <div id="distraction" class="dropzone"><h3>🤔 Could Be a Distraction</h3></div>
      </div>
      <h3 style="text-align: center;">Drag the Activities</h3>
      <div id="cards-container"></div>
    </div>
    <div style="text-align:center;">
        <button id="switch-to-minigame-btn">🎮 Play Side-Scroller Adventure!</button>
    </div>
  </div>

  <div id="minigame-screen" class="screen">
    <div class="panel">
      <h2>🎮 Advanced Mini-Game: Side-Scroller Adventure!</h2>
      <div class="minigame-header">
        <div class="minigame-stat">Adventure Score: <span id="minigame-score">0</span></div>
        <div class="minigame-stat">Kingdom Tokens: <span id="minigame-tokens">0</span> / 10</div>
        <div class="minigame-stat"><span class="hearts" id="minigame-lives">❤️❤️❤️</span></div>
      </div>
      <canvas id="minigame-canvas" width="600" height="300"></canvas>
      <button id="minigame-start-btn">Start Adventure 🚀</button>
      <div id="minigame-instructions">Use SPACE or ↑ to jump. Collect Kingdom Tokens 📖! Avoid distractions 📺!</div>
      <button id="switch-to-sorting-btn" style="margin-top: 10px; background-color:#777;">Back to Sorting Game</button>
    </div>
  </div>

</div>

<script>
// --- GAME STATE ---
const game = {
    character: 'cello',
    difficulty: 'easy',
    level: 1,
    maxLevels: 5,
    score: 0,
    streak: 0,
    timerId: null,
    timeLeft: 0,
    activeScreen: 'sorting'
};

// --- DOM ELEMENTS ---
const elements = {
    sortingScreen: document.getElementById('sorting-game-screen'),
    minigameScreen: document.getElementById('minigame-screen'),
    characterSelector: document.getElementById('character-selector'),
    difficultySelector: document.getElementById('difficulty-selector'),
    levelLabel: document.getElementById('level-label'),
    progressFill: document.getElementById('game-progress-fill'),
    scoreLabel: document.getElementById('score-label'),
    streakLabel: document.getElementById('streak-label'),
    timerLabel: document.getElementById('timer-label'),
    cardsContainer: document.getElementById('cards-container')
};

// --- 16-BIT PIXEL ART ASSETS ---
const pixelArt = {
    draw(ctx, drawFunc, x, y, size = 4) {
        drawFunc(ctx, x, y, size);
    },
    // Character Sprites
    characters: {
        cello: (ctx, x, y, size) => { // Boy character
            ctx.fillStyle = '#f2a66e'; // Skin
            ctx.fillRect(x + size, y, size * 2, size * 2);
            ctx.fillStyle = '#3a2d27'; // Hair
            ctx.fillRect(x + size, y, size * 2, size);
            ctx.fillStyle = '#4a90e2'; // Shirt
            ctx.fillRect(x, y + size * 2, size * 4, size * 2);
            ctx.fillStyle = '#333'; // Pants
            ctx.fillRect(x + size, y + size * 4, size * 2, size);
        },
        fina: (ctx, x, y, size) => { // Girl character
            ctx.fillStyle = '#ffbe87'; // Skin
            ctx.fillRect(x + size, y, size * 2, size * 2);
            ctx.fillStyle = '#8b572a'; // Hair
            ctx.fillRect(x, y, size * 4, size);
            ctx.fillRect(x, y + size, size, size*2);
            ctx.fillRect(x + size * 3, y + size, size, size * 2);
            ctx.fillStyle = '#e91e63'; // Dress
            ctx.fillRect(x, y + size * 2, size * 4, size * 2);
        },
        teen: (ctx, x, y, size) => { pixelArt.characters.fina(ctx,x,y,size); },
        adult: (ctx, x, y, size) => { pixelArt.characters.cello(ctx,x,y,size); }
    },
    // Game Objects
    token: (ctx, x, y, size) => { // Kingdom Token / Bible
        ctx.fillStyle = '#795548'; // Cover
        ctx.fillRect(x, y, size * 4, size * 3);
        ctx.fillStyle = '#fff'; // Pages
        ctx.fillRect(x + size, y + size, size * 2, size);
    },
    distractions: {
        tv: (ctx, x, y, size) => {
            ctx.fillStyle = '#333'; // Frame
            ctx.fillRect(x, y, size * 5, size * 4);
            ctx.fillStyle = '#87ceeb'; // Screen
            ctx.fillRect(x + size, y + size, size * 3, size * 2);
        },
        phone: (ctx, x, y, size) => {
            ctx.fillStyle = '#555';
            ctx.fillRect(x, y, size * 2, size * 4);
            ctx.fillStyle = '#fff';
            ctx.fillRect(x, y + size, size * 2, size * 2);
        }
    }
};


// --- SIDE SCROLLER MINIGAME ---
const sideScroller = {
    canvas: document.getElementById('minigame-canvas'),
    ctx: null,
    active: false,
    gameInterval: null,
    // State
    score: 0, lives: 3, tokens: 0, goal: 10, frame: 0,
    // Game Objects
    player: { x: 50, y: 220, w: 16, h: 20, vy: 0, grounded: true },
    objects: [], // { type, x, y, w, h, sprite }
    backgroundLayers: [],

    init() {
        this.ctx = this.canvas.getContext('2d');
        document.getElementById('minigame-start-btn').onclick = () => this.start();
        document.addEventListener('keydown', e => {
            if ((e.code === 'Space' || e.key === 'ArrowUp') && this.active) this.jump();
        });
        this.canvas.addEventListener('click', () => { if(this.active) this.jump(); });
    },
    start() {
        this.active = true;
        this.lives = 3; this.score = 0; this.tokens = 0; this.frame = 0;
        this.player.y = 220; this.player.vy = 0; this.player.grounded = true;
        this.objects = [];
        this.backgroundLayers = [
            { speed: 0.2, y: 50, height: 50, color: '#add8e6', objects: [{x: 100, w: 50}, {x: 400, w: 80}] }, // Far clouds
            { speed: 0.5, y: 150, height: 100, color: '#228b22', objects: [{x: 50, w: 200}, {x: 500, w: 150}] }, // Hills
        ];
        if (this.gameInterval) clearInterval(this.gameInterval);
        this.gameInterval = setInterval(() => this.loop(), 1000 / 60);
        this.updateUI();
    },
    loop() {
        this.frame++;
        // --- Physics & Object Spawning ---
        this.player.vy += 0.8; // Gravity
        this.player.y += this.player.vy;
        if (this.player.y >= this.canvas.height - 40 - this.player.h) {
            this.player.y = this.canvas.height - 40 - this.player.h;
            this.player.vy = 0;
            this.player.grounded = true;
        }

        // Spawn new objects
        if (this.frame % 120 === 0) { // Distractions
            const isTV = Math.random() > 0.5;
            this.objects.push({ type: 'distraction', x: this.canvas.width, y: this.canvas.height - (isTV ? 56 : 56), w: (isTV ? 20 : 8), h: (isTV ? 16 : 16), sprite: isTV ? 'tv' : 'phone' });
        }
        if (this.frame % 180 === 0) { // Tokens
            this.objects.push({ type: 'token', x: this.canvas.width, y: 180, w: 16, h: 12, sprite: 'token' });
        }

        // Move and check collisions
        this.objects.forEach((obj, i) => {
            obj.x -= 4; // Move object
            if (this.player.x < obj.x + obj.w && this.player.x + this.player.w > obj.x &&
                this.player.y < obj.y + obj.h && this.player.y + this.player.h > obj.y) {
                this.handleCollision(obj, i);
            }
        });
        this.objects = this.objects.filter(o => o.x > -50);
        this.score++;

        // --- Drawing ---
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        this.drawBackground();
        this.drawObjects();
        pixelArt.draw(this.ctx, pixelArt.characters[game.character], this.player.x, this.player.y);
        
        this.updateUI();
        if (this.lives <= 0 || this.tokens >= this.goal) this.endGame();
    },
    drawBackground() {
        // Parallax Layers
        this.backgroundLayers.forEach(layer => {
            this.ctx.fillStyle = layer.color;
            layer.objects.forEach(obj => {
                let objX = (obj.x - (this.frame * layer.speed)) % (this.canvas.width + obj.w);
                if (objX < -obj.w) objX += (this.canvas.width + obj.w);
                this.ctx.fillRect(objX, layer.y, obj.w, layer.height);
            });
        });
        // Ground
        this.ctx.fillStyle = '#556b2f';
        this.ctx.fillRect(0, this.canvas.height - 40, this.canvas.width, 40);
    },
    drawObjects() {
        this.objects.forEach(obj => {
            if (obj.type === 'token') {
                pixelArt.draw(this.ctx, pixelArt.token, obj.x, obj.y);
            } else if (obj.type === 'distraction') {
                pixelArt.draw(this.ctx, pixelArt.distractions[obj.sprite], obj.x, obj.y);
            }
        });
    },
    handleCollision(obj, index) {
        if (obj.type === 'distraction') {
            this.lives--;
            this.objects.splice(index, 1); // Remove object on hit
        } else if (obj.type === 'token') {
            this.tokens++;
            this.score += 100;
            this.objects.splice(index, 1);
        }
    },
    endGame() {
        this.active = false;
        clearInterval(this.gameInterval);
        this.ctx.fillStyle = 'rgba(0,0,0,0.5)';
        this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
        this.ctx.fillStyle = 'white';
        this.ctx.font = `24px "${getComputedStyle(document.body).getPropertyValue('--font-header')}"`;
        this.ctx.textAlign = 'center';
        const message = this.tokens >= this.goal ? "You Win! Great job!" : "Game Over. Try Again!";
        this.ctx.fillText(message, this.canvas.width / 2, this.canvas.height / 2);
    },
    jump() {
        if (this.player.grounded) {
            this.player.vy = -16;
            this.player.grounded = false;
        }
    },
    updateUI() {
        document.getElementById('minigame-score').textContent = this.score;
        document.getElementById('minigame-tokens').textContent = `${this.tokens} / ${this.goal}`;
        document.getElementById('minigame-lives').textContent = '❤️'.repeat(this.lives) + '🖤'.repeat(3 - this.lives);
    }
};

// --- UI AND EVENT HANDLERS ---
function switchScreen(screenName) {
    elements.sortingScreen.classList.toggle('active', screenName === 'sorting');
    elements.minigameScreen.classList.toggle('active', screenName === 'minigame');
    game.activeScreen = screenName;
    if (screenName === 'minigame' && sideScroller.active) {
        sideScroller.endGame();
    }
}

document.getElementById('switch-to-minigame-btn').onclick = () => switchScreen('minigame');
document.getElementById('switch-to-sorting-btn').onclick = () => switchScreen('sorting');

elements.characterSelector.onchange = (e) => { game.character = e.target.value; };
// For now, sorting game is stubbed out but controls are here for future use
elements.difficultySelector.onchange = (e) => { game.difficulty = e.target.value; };

// --- INITIALIZE ---
window.onload = () => {
    sideScroller.init();
};

</script>
</body>
</html>
